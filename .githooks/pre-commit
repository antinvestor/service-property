#!/bin/bash

# Pre-commit hook to run make format on Go files
# To enable: git config core.hooksPath .githooks

set -e

# Check if there are any staged Go files
STAGED_GO_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.go$' || true)

if [ -n "$STAGED_GO_FILES" ]; then
    echo "Running make format..."

    if ! make format; then
        echo "make format failed. Please fix the errors and try again."
        exit 1
    fi

    # Check if formatting changed any files
    CHANGED_FILES=$(git diff --name-only | grep '\.go$' || true)

    if [ -n "$CHANGED_FILES" ]; then
        echo ""
        echo "The following files were modified by make format:"
        echo "$CHANGED_FILES"
        echo ""
        echo "Please review the changes and stage them before committing."
        exit 1
    fi

    echo "Go files formatted successfully."
fi

exit 0
